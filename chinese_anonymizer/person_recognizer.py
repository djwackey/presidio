"""
中文人名识别器
Chinese Person Name Recognizer
"""

from typing import List, Optional
import re
from presidio_analyzer import Pattern, PatternRecognizer


class ChinesePersonRecognizer(PatternRecognizer):
    """
    识别中文人名的识别器
    Recognizer for Chinese person names
    """

    # 常见的中文姓氏（部分）
    COMMON_SURNAMES = [
        "彭",
        "伊",
        "孙",
        "冉",
        "田",
        "齐",
        "黎",
        "纪",
        "容",
        "杨",
        "尤",
        "江",
        "萧",
        "阎",
        "庞",
        "陶",
        "段",
        "许",
        "岳",
        "邱",
        "党",
        "屈",
        "舒",
        "丁",
        "罗",
        "赵",
        "公西",
        "公乘",
        "平",
        "钟",
        "申",
        "阮",
        "吕",
        "龚",
        "梁",
        "何",
        "南",
        "宋",
        "计",
        "曹",
        "上官",
        "南宫",
        "言",
        "子",
        "朱",
        "戴",
        "鄂",
        "车",
        "曲",
        "侯",
        "独孤",
        "麦",
        "米",
        "宝",
        "司空",
        "应",
        "穆",
        "谭",
        "巴",
        "孔",
        "萨",
        "郁",
        "夏",
        "陆",
        "项",
        "黄",
        "木",
        "任",
        "汤",
        "毛",
        "谢",
        "钱",
        "宁",
        "莫",
        "尉迟",
        "姚",
        "公冶",
        "惠",
        "井",
        "郑",
        "滕",
        "俞",
        "崔",
        "潘",
        "端木",
        "沈",
        "东方",
        "谷",
        "蓝",
        "达",
        "公良",
        "涂",
        "司马",
        "景",
        "闵",
        "倪",
        "白",
        "于",
        "符",
        "欧阳",
        "费",
        "熊",
        "子车",
        "赖",
        "姜",
        "范",
        "吴",
        "哈",
        "周",
        "叶",
        "孟",
        "文",
        "肖",
        "鲁",
        "农",
        "董",
        "洪",
        "余",
        "虞",
        "公玉",
        "皮",
        "杜",
        "阿",
        "公叔",
        "辛",
        "李",
        "蒋",
        "龙",
        "张",
        "尹",
        "皇甫",
        "胡",
        "袁",
        "司徒",
        "苗",
        "梅",
        "柯",
        "万",
        "雷",
        "华",
        "葛",
        "诸葛",
        "纳",
        "方",
        "刘",
        "魏",
        "傅",
        "高",
        "金",
        "云",
        "成",
        "顾",
        "瓦",
        "邬",
        "章",
        "夏侯",
        "唐",
        "聂",
        "乔",
        "石",
        "郭",
        "单",
        "程",
        "甘",
        "牛",
        "童",
        "查",
        "包",
        "贺",
        "年",
        "西门",
        "韦",
        "康",
        "骆",
        "公羊",
        "邵",
        "马",
        "伍",
        "沙",
        "史",
        "苏",
        "常",
        "武",
        "劳",
        "公仲",
        "臧",
        "卢",
        "令狐",
        "乌",
        "席",
        "欧",
        "慕容",
        "王",
        "曾",
        "贾",
        "尚",
        "郝",
        "薛",
        "易",
        "宇文",
        "房",
        "长孙",
        "祁",
        "廖",
        "公孟",
        "陈",
        "邓",
        "公明",
        "才",
        "关",
        "裴",
        "邹",
        "公仪",
        "冯",
        "茅",
        "韩",
        "仓",
        "盛",
        "蔡",
        "秦",
        "林",
        "柳",
        "汪",
        "徐",
        "郎",
    ]

    # 构建姓氏模式
    surnames_pattern = "|".join(COMMON_SURNAMES)

    PATTERNS = [
        # 姓氏 + 1-2个字的名字，前后有分隔符或特定上下文
        Pattern(
            "CHINESE_NAME_WITH_CONTEXT",
            rf"(?<=患者|病人|姓名|名字)[\s：:]*({surnames_pattern})[\u4e00-\u9fff]{{1,2}}",
            0.95,
        ),
        # 姓氏 + 1-2个字的名字，在句首或标点后
        Pattern(
            "CHINESE_NAME_PATTERN",
            rf"(?<=^|[，。！？\s])({surnames_pattern})[\u4e00-\u9fff]{{1,2}}(?=[，。！？\s的]|$)",
            0.9,
        ),
        # 姓氏 + 名字 + 女士/先生/同志等称谓
        Pattern(
            "CHINESE_NAME_WITH_TITLE",
            rf"({surnames_pattern})[\u4e00-\u9fff]{{1,2}}(?=女士|先生|同志|医生|教授|老师)",
            0.95,
        ),
        # 两字姓名，增加上下文限制
        Pattern(
            "CHINESE_TWO_CHAR_NAME", rf"(?<=^|[，。！？\s])({surnames_pattern})[\u4e00-\u9fff](?=[，。！？\s的]|$)", 0.8
        ),
    ]

    CONTEXT = [
        "姓名",
        "名字",
        "称呼",
        "患者",
        "病人",
        "先生",
        "女士",
        "同志",
        "name",
        "patient",
        "person",
        "mr",
        "ms",
        "男",
        "女",
    ]

    def __init__(self):
        super().__init__(
            supported_entity="PERSON", patterns=self.PATTERNS, context=self.CONTEXT, supported_language="zh"
        )
